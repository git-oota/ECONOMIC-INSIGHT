// index.html の <script> 内、render関数付近を修正

        function render() {
            const lang = document.getElementById('langSet').value;
            const contentArea = document.getElementById('content-area');
            const archiveList = document.getElementById('archive-list'); // ★追加：これがないとエラーになります

            if (articles.length === 0) {
                contentArea.innerHTML = `<p class="text-center">データがありません</p>`;
                return;
            }

            const data = articles[currentIndex];
            
            // 本文の取得（存在しない場合のフォールバック）
            let contentText = (data.contents && data.contents[lang]) ? data.contents[lang] : "Content not available";
            let htmlBody = contentText.replace(/\n/g, '<br>');

            // 用語解説の置換処理
            if (data.glossary && Array.isArray(data.glossary)) {
                // 長い単語から順に置換（短い単語が長い単語の一部である場合の誤作動防止）
                const sortedGlossary = [...data.glossary].sort((a, b) => b.term[lang].length - a.term[lang].length);
                
                sortedGlossary.forEach(item => {
                    const term = item.term[lang];
                    const def = item.def[lang];
                    const regex = new RegExp(term, 'g');
                    htmlBody = htmlBody.replace(regex, `<span class="glossary-term" onclick="showGlossary('${term}', '${def}')">${term}</span>`);
                });
            }

            // タイトルなどの流し込み
            const title = (data.titles && data.titles[lang]) ? data.titles[lang] : "No Title";

            contentArea.innerHTML = `
                <div class="text-blue-600 font-black mb-4 text-sm uppercase">${data.date}</div>
                <h2 class="text-3xl md:text-5xl font-black mb-12 leading-tight">${title}</h2>
                <div class="prose prose-lg max-w-none text-slate-700 leading-relaxed mb-16">${htmlBody}</div>
                <div class="my-12 p-8 bg-slate-50 border border-slate-100 rounded-3xl">
                    <h3 class="font-black text-sm mb-8 uppercase text-slate-400">Visual Insights</h3>
                    <pre class="mermaid flex justify-center">${data.mermaid[lang] || ""}</pre>
                </div>
            `;

            // アーカイブリストの更新
            archiveList.innerHTML = articles.map((art, idx) => {
                const artTitle = (art.titles && art.titles[lang]) ? art.titles[lang] : "Untitled";
                return `
                <div onclick="changeArticle(${idx})" class="archive-item p-5 bg-white rounded-2xl shadow-sm flex justify-between items-center ${idx === currentIndex ? 'ring-2 ring-blue-500' : ''}">
                    <div class="overflow-hidden">
                        <div class="text-[10px] text-slate-400 font-bold mb-1">${art.date}</div>
                        <div class="font-black text-slate-800 truncate text-sm uppercase">${artTitle}</div>
                    </div>
                    <span class="text-blue-500 font-black ml-4">→</span>
                </div>`;
            }).join('');

            if (window.mermaid) {
                mermaid.contentLoaded(); // mermaidのリロード
                mermaid.run({ nodes: document.querySelectorAll('.mermaid') });
            }
        }
